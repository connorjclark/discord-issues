## ‚ùåLayered Lock Blocks Don't Work by Default (#2361)
@ Twilight Knight opened this issue on 05/07/2023
Status: unknown
Tags: Closed,Added
Source: #feature-requests https://discord.com/channels/876899628556091432/1104735608309563473


=== @ Twilight Knight 05/07/2023 11:44

Hey devs,
Is it possible to add a "quick compile" button or option to ZQuest after which the slots don't need to be assigned? Because 99% of the time I'm compiling without assigning slots and this would speed the process up quite a bit.

Or if there is already a way to achieve that, please let me know : -)

=== @EmilyV99 (discord: Emily) 05/07/2023 16:27

(replying to @ Twilight Knight "Hey devs,
Is it possible to a‚Ä¶"): err, every time you compile you are assigning slots, otherwise the compile is not saved
(Hitting `OK` in the assign slots dialog, just the one button, does a LOT of work)

=== @ ywkls 05/07/2023 19:56

@ Rebonite -Correct me if I am wrong, but it sounds like you think that you have to assign each individual script to a specific slot every time you compile? If so, let me assure you that this is not the case. Once a script is assigned to a specific slot, it never has to be assigned again; even if you change the contents of that script. You can simply assign slots for any newly added scripts.

=== @EmilyV99 (discord: Emily) 05/07/2023 19:58

...yeah, if you didn't know that, that's pretty important to know. 99% of the time all you need to do in the assign slots dialog is hit `OK`- unless you changed the name of a script, or added a new script.

=== @ ywkls 05/07/2023 20:02

If you are just trying to check for errors, you can cancel after compiling

=== @EmilyV99 (discord: Emily) 05/07/2023 20:03

^ that too. Obviously that doesn't save the changes to the quest- that requires the assign slots dialog OK button to be pressed, as that's when it saves the compiled script to the quest.

=== @ ywkls 05/07/2023 20:03

I don't think that there is a way to cut down the delay after successfully compiling and assigning slots (if necessary)

=== @ ywkls 05/07/2023 20:04

I know from personal experience just how long that can be and imagine that it would only increase with the size of the script file

=== @EmilyV99 (discord: Emily) 05/07/2023 20:09

(replying to @ ywkls "I don't think that there is a‚Ä¶"): yeah, that time there is it converting the Opcode objects to proper ZASM code and saving them to the slots in the quest file. It's a super complicated and very easy to break bit of ancient code.
There may be some optimizations we can do, but, *super complicated and very easy to break*.

=== @ Twilight Knight 05/07/2023 20:55

Of course I know I don't have to reassing the slots every time. I simply meant that I get that dialogue every time and need to confirm that as well while it's unnecessary.

=== @ Twilight Knight 05/07/2023 20:58

As in, simply having to press OK and waiting for that to also finish could be merged with the first compile.

I understand it's necessary and of course sometimes you have new/removed/renamed scripts sometimes, but it'd be nice to be able to skip this. As it is often the case I'm debugging my scripts and don't need to reassign
![image](https://cdn.discordapp.com/attachments/1104735608309563473/1104874935551266816/image.png?ex=65e4e478&is=65d26f78&hm=4daaea8ce4857be354f0a2b3780caf051b088caed75ce83d6848420b46a6faf6&)

=== @ Twilight Knight 05/07/2023 21:00

Having a separate button in this dialog would be perfect if you ask me
![image](https://cdn.discordapp.com/attachments/1104735608309563473/1104875445893201920/image.png?ex=65e4e4f1&is=65d26ff1&hm=21ec89987b811485d99758f8dc4ab45684000ae995558c51d56f8080b8c33b4e&)
Compile & assign
Sorry if my initial description was too vague

=== @EmilyV99 (discord: Emily) 05/07/2023 21:01

ahk
do note that this will require a *lot* of backend work
those two windows are entirely different sections of code
not gonna be high priority
but, I'll get around to it

=== @ Twilight Knight 05/07/2023 21:03

Ah alright, I wouldn't have expected that it'd be that complicated!
But tnx, it would be a nice feature to speed up scripting for me
Especially with tweaking enemies ü§Ø

=== @EmilyV99 (discord: Emily) 05/07/2023 21:05

I have an idea for an optimization to the assign slots process to make it faster as well... which will be even more complicated. Whenever I get the burst of energy for that, I'll probably do this too.

=== @ Twilight Knight 05/07/2023 21:08

Sounds interesting!
Something like adding more caching?

=== @ Twilight Knight 05/07/2023 21:10

Also just now had an even more supreme idea:
Compile, assign & test quest üòÇ 
It is my most usual process while scripting
But with the new hotkeys I have it's quite a simple process already

=== @EmilyV99 (discord: Emily) 05/07/2023 21:11

(replying to @ Twilight Knight "Sounds interesting!
Something‚Ä¶"): So, the problem is, the code around assigning slots is jank SUPER complex old code spaghetti

=== @EmilyV99 (discord: Emily) 05/07/2023 21:12

and basically, the way it works, it has to write out to a temporary file, and then reads from that file to process it into zasm (presumably because they just lazily reused the `Import ZASM` code handling when building the initial ZScript parser. Yay.)
So, I need to rewrite the spaghetti.
because surely I can use some string stream class in memory instead of needing to use a file, which *HAS* to be faster.
but, the problem there being, *rewriting the spaghetti*.
To be fair, I have previously *edited* the spaghetti, so if anyone is qualified to rewrite it it'd be me.
(The major optimization I made for array/string initializers involved changing the ZASM file format, which means editing this crap.)
And I think I also had to edit it to fix a crash with buffer stuff or something at some point?

=== @ Twilight Knight 05/07/2023 21:18

Ah so you made it possible that you can now initialise arrays like {1,2,3}. I'm thankful for that!
I knew that wasn't possible before.
Haven't even played with strings lately in ZScript, those used to be very very limited. But sounds like you did some good things there as well?

And indeed sounds inefficient to write to an external file. I couldn't really imagine why that's necessary, I imagine any computer nowadays could handle some scripts in memory

=== @EmilyV99 (discord: Emily) 05/07/2023 21:18

> Ah so you made it possible that you can now initialise arrays like {1,2,3}. I'm thankful for that!
> I knew that wasn't possible before.
err, for initializing an array variable, that was possible before.
What I did was optimized it to take much less ZASM when you do that

=== @ Twilight Knight 05/07/2023 21:19

Really? Let's say it wasn't documented before then üòÖ
I rely much on the docs

=== @EmilyV99 (discord: Emily) 05/07/2023 21:20

(replying to @ Twilight Knight "Really? Let's say it wasn't d‚Ä¶"): Does appear to be present in an example in zscript.txt
![image](https://cdn.discordapp.com/attachments/1104735608309563473/1104880345679151115/image.png?ex=65e4e982&is=65d27482&hm=e7b315e6ac91dc8ea3551e109c5192d4c9391aad79f260c52efac7a00bb96d3a&)

=== @ Twilight Knight 05/07/2023 21:20

And spaghetti code... I've been there. It sucks
Especially the immense lack of comments

=== @EmilyV99 (discord: Emily) 05/07/2023 21:20

but, it doesn't have it's own section explaining it or anything

=== @ Twilight Knight 05/07/2023 21:20

Well under "errors", no wonder üòõ

=== @EmilyV99 (discord: Emily) 05/07/2023 21:20

<:nekoSigh:1012187680467075092> docs are a mess
Eventually the web docs will be REALLY REALLY nice and finished and awesome
just, bit by bit every now and then when I have the energy to add some to them

=== @ Twilight Knight 05/07/2023 21:21

It'd like to help with it sometime if you want and I somehow have much time on my hands
I could especially make it easy for you to have a nice visualisation out of any source material (f.e. an .md file or whatever you'd like really)

=== @EmilyV99 (discord: Emily) 05/07/2023 21:22

If you know how to use git, you can branch the repo and pull request changes to the docs

=== @ Twilight Knight 05/07/2023 21:22

Aight, I'll keep that in mind

=== @EmilyV99 (discord: Emily) 05/07/2023 21:22

there's a really nice GUI editor for them that I wrote in python
at `[repo]/webdocs/docjson_main.py`

=== @ Twilight Knight 05/07/2023 21:22

Ah nice üëç 
The interface is nice but a little messy still if I may be honest

=== @EmilyV99 (discord: Emily) 05/07/2023 21:22


![image](https://cdn.discordapp.com/attachments/1104735608309563473/1104881088062558399/image.png?ex=65e4ea33&is=65d27533&hm=b0bae7a8640ded8f525fd457ed1c5c858e31f47ae5152b5d015fe09c544f8609&)

=== @ Twilight Knight 05/07/2023 21:23

Ahh wow, like a CMS of sorts
I was referring to the interface of the web docs btw, haven't seen this before

=== @EmilyV99 (discord: Emily) 05/07/2023 21:23

Originally, it was edited in a google sheets, with a javascript attached to it to generate the html file
and that was awful

=== @ Twilight Knight 05/07/2023 21:23

Yea haha

=== @EmilyV99 (discord: Emily) 05/07/2023 21:23

so I dumped the sheets out as a .json file
which, python can read just as well as javascript can

=== @ Twilight Knight 05/07/2023 21:24

Ah good, .json is the best

=== @EmilyV99 (discord: Emily) 05/07/2023 21:24

I used one python script to "upgrade" the .json, just re-organizing it to be easier to use with the new python script I was also writing at the time
and I learned the python Tkinter library, which is for GUI making

![image](https://cdn.discordapp.com/attachments/1104735608309563473/1104881615072665630/image.png?ex=65e4eab0&is=65d275b0&hm=acdf6f532204e2d56b585dee91e4a9a208c726123a8b60c290b73a32a16b2fb7&)
so, it has a bit of a folder structure

![image](https://cdn.discordapp.com/attachments/1104735608309563473/1104881681556582461/image.png?ex=65e4eac0&is=65d275c0&hm=e29f6fd6606d8854e2c3fb7e824621af144a7a0ef25130c5c7b52090c57f0b4f&)

=== @ Twilight Knight 05/07/2023 21:25

Ah yes I see

=== @EmilyV99 (discord: Emily) 05/07/2023 21:25

(I just opened the thing highlighted in the previous screenshot both of those times)
getting here, this may be recognizable:
![image](https://cdn.discordapp.com/attachments/1104735608309563473/1104881868807086301/image.png?ex=65e4eaed&is=65d275ed&hm=0815de0b8ad76c1c438cb2a01ca790acf5c4339e35cb7400046a84205cf1f3b7&)

=== @ Twilight Knight 05/07/2023 21:26

I see the structure of the docs in that üòÑ
Yep, I use these a lot now

=== @EmilyV99 (discord: Emily) 05/07/2023 21:26

`Base Data->Root (HTML home)` is named as such because it is the homepage

=== @ Twilight Knight 05/07/2023 21:26

I want to help with visualising that in html if you'd like
Writing some css and that kind of thing

=== @EmilyV99 (discord: Emily) 05/07/2023 21:27

(replying to @EmilyV99 (discord: Emily) ""): the first entry here, since it is named `--`, is invisible, but it's text automatically displays. That entry has the `ZScript Web Documentation` text in it.

=== @ Twilight Knight 05/07/2023 21:27

And writing docs is also good for me, but I don't know much without the docs I'm not experienced in reading the source code

=== @EmilyV99 (discord: Emily) 05/07/2023 21:27

the rest link to other pages
(replying to @ Twilight Knight "Writing some css and that kin‚Ä¶"): as for css...

=== @ Twilight Knight 05/07/2023 21:28

(replying to @EmilyV99 (discord: Emily) "the first entry here, since i‚Ä¶"): ah clever solution for that

=== @EmilyV99 (discord: Emily) 05/07/2023 21:29


https://cdn.discordapp.com/attachments/1104735608309563473/1104882661211770910/message.css?ex=65e4ebaa&is=65d276aa&hm=d7f3d47fd792d5c7baa878efd13448ebc81a2d643e883abe6142b18d00fa50ba&
that is the current css
It is embedded inside the `docjson_lib.py` file in a string block

![image](https://cdn.discordapp.com/attachments/1104735608309563473/1104882901188878356/image.png?ex=65e4ebe3&is=65d276e3&hm=e449a7b968b0657275e2a3efff74336a5e196f41e6ab5c92f06bad52ac4b672b&)

=== @ Twilight Knight 05/07/2023 21:30

Did you write it yourself? It's not bad!

=== @EmilyV99 (discord: Emily) 05/07/2023 21:30

aye, it's all mine.
every single thing about this is all my design

=== @ Twilight Knight 05/07/2023 21:30

I've seen some horrible css üò± talking bout spaghetti code

=== @EmilyV99 (discord: Emily) 05/07/2023 21:30

spent a solid couple months on the original design, and I've built it up since over time
another solid month was spent upgrading it to the python

=== @ Twilight Knight 05/07/2023 21:31

Great job, I like these docs a whole lot better than some boring ass text file

=== @EmilyV99 (discord: Emily) 05/07/2023 21:31

The `.pagecont` qualifier on every entry is there because of how this gets embedded on the website

=== @ Twilight Knight 05/07/2023 21:32

I could have a stab at some css improvements if you'd like. But at this moment I spend all spare time working on my quest for the expo üòé

=== @EmilyV99 (discord: Emily) 05/07/2023 21:32

the entire body of the html file is `pagecont` class, so, if you just open the html file, the css just applies to everything

=== @ Twilight Knight 05/07/2023 21:32

(replying to @EmilyV99 (discord: Emily) "The `.pagecont` qualifier on‚Ä¶"): yeah I understand you don't want to accidentally overwrite another element outside of the docs

=== @EmilyV99 (discord: Emily) 05/07/2023 21:32

but when embedded on the webpage, it kinda erases a bunch of the header (because duplicate header elements are ignored, and it has an automatic header and shit I can't edit)
and the `.pagecont` qualifier serves to ensure none of my css applies over the site header and background and such

=== @ Twilight Knight 05/07/2023 21:33

Tried !important? Lemme see

=== @EmilyV99 (discord: Emily) 05/07/2023 21:33

no, I didn't know that existed
`.pagecont` doubles as an extra layer of specificity, so I don't need it
anyway, here is the actual editor for the webdocs:
![image](https://cdn.discordapp.com/attachments/1104735608309563473/1104884021202264295/image.png?ex=65e4ecee&is=65d277ee&hm=461475247e0f83570d096bf6abd999401641de5289c58d9e0edc7541af711d90&)

=== @ Twilight Knight 05/07/2023 21:34

Indeed, but what do you mean by "it kinda erases a bunch of the header" then?

=== @EmilyV99 (discord: Emily) 05/07/2023 21:35

(replying to @ Twilight Knight "Indeed, but what do you mean‚Ä¶"): I'm just dumping an html file embedded inside another html file. That doesn't work perfectly, so I had to jank workaround a couple things in designing the html/css

=== @ Twilight Knight 05/07/2023 21:35

(replying to @EmilyV99 (discord: Emily) "anyway, here is the actual ed‚Ä¶"): ah really good. Also using HTML as input is good üëç

=== @EmilyV99 (discord: Emily) 05/07/2023 21:35

Not only is html input allowed
It adds extra newlines at the top and bottom when you go to edit, which are automatically trimmed in the output- those are just there for convenience allowing you not to need to press enter as much
and the buttons on the right insert html templates, as well as some special custom markdown templates

![image](https://cdn.discordapp.com/attachments/1104735608309563473/1104884564469493883/image.png?ex=65e4ed6f&is=65d2786f&hm=932fff7231771ca7f46b232feeec559e6b229fb2d1d67e5629fd9a7eeb603f78&)

=== @ Twilight Knight 05/07/2023 21:36

(replying to @EmilyV99 (discord: Emily) "I'm just dumping an html file‚Ä¶"): that's fine. Sometimes an <iframe> is a good solution but I find them pretty janky too

=== @EmilyV99 (discord: Emily) 05/07/2023 21:37

Notice in this highlighted section, it starts with `#{`, then has some content, then has a closing `}`

=== @ Twilight Knight 05/07/2023 21:37

(replying to @EmilyV99 (discord: Emily) "and the buttons on the right‚Ä¶"): yea very useful I see. Future proof solutions I like it a lot

=== @EmilyV99 (discord: Emily) 05/07/2023 21:37


![image](https://cdn.discordapp.com/attachments/1104735608309563473/1104884731021107273/image.png?ex=65e4ed97&is=65d27897&hm=110eccf3d9c0155c7bf5d532cbdae7bcb515a528ec7e0fce5f8394e2e90bebc2&)
That's this spoiler folder formatting.
The `Show More`/`Show Less` button is actually entirely *CSS*, not html at all
the rest is IIRC a span or two with specific classes, and associated css

=== @ Twilight Knight 05/07/2023 21:38

Yeah input:checked üòÑ

=== @EmilyV99 (discord: Emily) 05/07/2023 21:38

```css
.pagecont .spoiler::before {
    content: attr(showtext) '  ';
    font-size: var(--spoiler-font-scale);
}

.pagecont .spoiler {
    display:block;
    border: 1px solid black;
    padding: 2px 20px 4px;
    background: linear-gradient(90deg, #DDD, #DDD, #DDD, #DDD, #DDD, #DDD, #AAA);
}

.pagecont .spoilbody {
    display: block;
    border-top: 1px solid black;
    padding: 5px 0 0 0;
}
```
```css
.pagecont .showbutton[data-active='0']::before {
    content: 'Show More';
}
.pagecont .showbutton[data-active='1']::before {
    content: 'Show Less';
}
```

=== @ Twilight Knight 05/07/2023 21:39

Ahh you must have used some JS for that!

=== @EmilyV99 (discord: Emily) 05/07/2023 21:39

ah, so the button is actually in the html, changed that from originally
and yeah, there's a whole js thing
`data-active` is managed by the buttons' on-click event

=== @ Twilight Knight 05/07/2023 21:40

Something is settings `display: none;` on .spoilbody ü§ì
(replying to @EmilyV99 (discord: Emily) "The `Show More`/`Show Less` b‚Ä¶"): Ahh I understand now üòÇ
It is not a <button>
I'm stoned, xcuse me

=== @EmilyV99 (discord: Emily) 05/07/2023 21:41

```js
function handle_spoilers()
{
    let sp = document.querySelectorAll('.spoiler');
    for(let q = 0; q < sp.length; ++q)
    {
        let button = sp[q].getElementsByClassName('showbutton')[0];
        let block = sp[q].getElementsByClassName('spoilbody')[0];
        button.addEventListener('click', function(){
            if(button.dataset.active == '0')
            {
                button.dataset.active = '1';
                hide(block,true);
            }
            else
            {
                button.dataset.active = '0';
                hide(block,false);
            }
        });
    }
}
```
it actually is a button, I misremembered
it used to be just css, but I changed it at some point
I, too, am stoned, lol

=== @ Twilight Knight 05/07/2023 21:42

`<span class="showbutton" data-active="0"></span>` no it's a <span>?

=== @EmilyV99 (discord: Emily) 05/07/2023 21:42

oh, nevermind
it's not pure css though
it used to be pure css, with no html element
now it's a span

=== @ Twilight Knight 05/07/2023 21:42

Could be pure CSS ü§ì

=== @EmilyV99 (discord: Emily) 05/07/2023 21:42

```js
function hide(ob,vis)
{
    ob.hidden = !vis;
    ob.style.display = vis ? null : 'none';
}
```
that's what handles the display hiding for the spoilbody
(replying to @EmilyV99 (discord: Emily) "```js
function handle_spoiler‚Ä¶"): ^called here

=== @EmilyV99 (discord: Emily) 05/07/2023 21:44

the entirety of the css and js are both just in the `docjson_lib.py` file as string blocks, so, easy to edit and pull request changes for if you have any improvements you want to offer

https://cdn.discordapp.com/attachments/1104735608309563473/1104886670521815100/docjson_lib.py?ex=65e4ef66&is=65d27a66&hm=d418d0aa8fe1d9cfcd9f00d3f6f5b8074cc4f8d94a5143f500d16b316d36039a&
line `576` for css, `910` for js if you just want to look without needing to do the whole git thing first
or, I can, uh

https://cdn.discordapp.com/attachments/1104735608309563473/1104886990329106472/message.js?ex=65e4efb2&is=65d27ab2&hm=645fe0a816d708625f27b4a63809aca00072886c3a9f62009dd75852678ce522&
also do that so it has js highlighting
(replying to @EmilyV99 (discord: Emily) ""): css one here
The HTML, then:
```py
    ret = f"""<!DOCTYPE html>
<html lang="en" dir="ltr">
<head>
    <meta charset="utf-8">
    <title>{ptitle}</title>
{css}
</head>
<body class = "pagecont">
<header class = "pagecont">
    <h1>{header}</h1>
    <p>Last Updated: {update_date()}{url}</p>
</header>
<main class = "pagecont">
    <div class='modal' id = 'ttipmodal'>
        <div class='modal_content'>
            <span class='closemodal'>&times;</span>
            <h3 id='modaltitle'></h3>
            <hr/>
            <div id='modalcontent'></div>
        </div>
    </div>
    <a class = "link" data-link = "root" data-bid = 0 data-tid = 0>Return to Top</a>
    <form id='searchform' style='display:inline;float:right'>
        <div style='display:inline'>
            <input type='text' id='docsearch' autocomplete='off' placeholder='Search...' />
            <div id='searchprev' style='display:none' hidden></div>
        </div>
        <input type='submit' id='submitsearch' value='Jump' />
    </form>
    <div class = "panel">
{generated_data}
    </div>
</main>
{js}
</body>
</html>
"""```
This one is a python formatted string, that inserts variables with `{varname}`

![image](https://cdn.discordapp.com/attachments/1104735608309563473/1104887506027155548/image.png?ex=65e4f02d&is=65d27b2d&hm=6b4be1a981dc63a9fa8cca1927692eeec143d77355b9efb57559b051254b696a&)
This window from `Page->Settings` in the gui allows you to edit some of these variables
`update_date()` fetches the current date, which is listed at the top of the html page as "Last Updated"
`{css}` and `{js}` obviously insert those entire files
and `{generated_data}` inserts all of the actual documentation, as generated by the script.

=== @ Twilight Knight 05/07/2023 21:50

Use an <input type="checkbox"> f.e. and with CSS you could have a `:checked` selector on that & there are also sibling selectors in CSS

So you'd have

```
<label class="showButton" for="showButton-ensureThisIsUniqueSomehow">Show <span class="more">more</span><span class="less">less</span></label><input type="checkbox" class="showButtonInput" id="showButton-ensureThisIsUniqueSomehow"/>
<div class="hiddenthingy"></div>```

And as CSS

```label.showButton {
  // btn styling
}

input.showButtonInput,
.hiddenthingy { 
  display: none;
}

input.showButtonInput:checked + .hiddenthingy {
  display: block;
}```

Something like that should work. Pure CSS solution with the label being your "button" and because the label triggers the input with the same ID as the label's for prop it will make the input :checked. And finally the + selector is the sibling selector with which you can unhide the hidden thingy

=== @EmilyV99 (discord: Emily) 05/07/2023 21:51

`id="showButton-ensureThisIsUniqueSomehow"`
^I've been trying to avoid this
aside from the numbers that link the actual tabs together
which are just their array index in the json array
because, as it is, I can just open the json file and manually edit any entry, and save it, and it works
If I have a unique generated ID like that, I can no longer just edit the json, as I would need to manually ensure the unique ID

=== @ Twilight Knight 05/07/2023 21:53

yes indeed it is best practice to avoid many unique IDs on elements they take a (however minimal) bit of memory in the browser

=== @EmilyV99 (discord: Emily) 05/07/2023 21:53

with this, I simply use the `data-active` element on the span to track the state
...but, your solution is removing the js, is the point, I see

=== @ Twilight Knight 05/07/2023 21:54

(replying to @EmilyV99 (discord: Emily) "If I have a unique generated‚Ä¶"): yes I saw that, that is fine also. But demonstrating that a lot is possible now with pure CSS
Indeed

=== @EmilyV99 (discord: Emily) 05/07/2023 21:54

but yeah, I've seen INSANE things with pure CSS

=== @ Twilight Knight 05/07/2023 21:55

Yes even animations are quite slick now with it

=== @EmilyV99 (discord: Emily) 05/07/2023 21:55

The nice thing is, web performance is pretty good, so on the scale of these docs I haven't really needed to worry too much about performance with anything
Which, considering that it is a *single webpage*, is pretty cool

=== @ Twilight Knight 05/07/2023 21:55

Yeah. And pure CSS is sweet and efficient, but really not that necessary unless you are a top something website and want to please google as much as possible

=== @EmilyV99 (discord: Emily) 05/07/2023 21:56

because, yes, every single tab, every single paragraph of text, all of it- it's all loaded and exists at once. Most of it is `display:none` at any given time.

=== @ Twilight Knight 05/07/2023 21:56

Also hardly anyone has JS turned off on their browser nowadays
(replying to @EmilyV99 (discord: Emily) "Which, considering that it is‚Ä¶"): Single page websites are the shit nowadays üòé

=== @EmilyV99 (discord: Emily) 05/07/2023 21:56

The main point is, not only is it one page, but the css and js are both embedded in the html file

=== @ Twilight Knight 05/07/2023 21:56

(replying to @EmilyV99 (discord: Emily) "because, yes, every single ta‚Ä¶"): don't see the harm in loading those few kbs

=== @EmilyV99 (discord: Emily) 05/07/2023 21:57

so it's a *single file*, which, yes, is included in the `docs` folder of every single nightly.

=== @ Twilight Knight 05/07/2023 21:57

Ah yea good, that way it is very easily accessible

=== @EmilyV99 (discord: Emily) 05/07/2023 21:57

purely accessible even offline
doesn't need a single thing from the web

=== @ Twilight Knight 05/07/2023 21:57

Very nice setup üëå

=== @EmilyV99 (discord: Emily) 05/07/2023 21:57

that was the entire design principal from the start
which really came from me just having the thought
`Well, an HTML file is just text, right? I can generate text procedurally with a script.... based on a table of data....`

=== @ Twilight Knight 05/07/2023 21:58

I'll let you know when I've made a pull request, it may take more than a month though cause of the expo

=== @EmilyV99 (discord: Emily) 05/07/2023 21:59

absolutely no rush lol

=== @ Twilight Knight 05/07/2023 21:59

(replying to @EmilyV99 (discord: Emily) "`Well, an HTML file is just t‚Ä¶"): Well you are in line with modern web designers. Static site generators are really popular nowadays

=== @EmilyV99 (discord: Emily) 05/07/2023 21:59

and I'll get a notification in discord anyway
For the record, here was the original editor:
![image](https://cdn.discordapp.com/attachments/1104735608309563473/1104890282991956128/image.png?ex=65e4f2c3&is=65d27dc3&hm=538c768eb3a6db53f18b8690f5052cbc93d852be6e74af79111a7549da34e245&)

=== @ Twilight Knight 05/07/2023 21:59

yiks

=== @EmilyV99 (discord: Emily) 05/07/2023 21:59

google sheets, as I said. You can see hte resemblance in how it's designed
Each set of 2 columns, became a folder in the python structure

=== @ Twilight Knight 05/07/2023 22:00

Yeah I can see the structure but it looks so painful to edit already

=== @EmilyV99 (discord: Emily) 05/07/2023 22:00


![image](https://cdn.discordapp.com/attachments/1104735608309563473/1104890454245396611/image.png?ex=65e4f2ec&is=65d27dec&hm=f80c4953ec4867b79f3df9b516128c40e90d65c4525d0d6fa76eb64bb61f258e&)
And there's a bunch of tabs, which you can link to by their name

![image](https://cdn.discordapp.com/attachments/1104735608309563473/1104890554585710592/image.png?ex=65e4f304&is=65d27e04&hm=24117ec8dcb45ece9d2dbe965242a5d7c03c861026295e4462aaf71e5dd07a6a&)
So, this was all of the `Hero->` docs

![image](https://cdn.discordapp.com/attachments/1104735608309563473/1104890646646489178/image.png?ex=65e4f31a&is=65d27e1a&hm=d37e5620f42a347b80ee388234e98ff1ea52d96787a936b7cbfc9b2f552b33d4&)
just double click to edit a whole cell, which worked mostly the same as the python editor now

=== @ Twilight Knight 05/07/2023 22:01

Well... it's not optimal but it works üòÅ

=== @EmilyV99 (discord: Emily) 05/07/2023 22:01

It was simple, familiar, and easy to prototype
also I didn't *know python* to do anything with it at that point
and, the nice thing is, google apps script JS can attach to a google sheet, and output a file output into google drive. So it was easy to script the chain together.

=== @ Twilight Knight 05/07/2023 22:02

I would've just built an editor using php myself probably

=== @EmilyV99 (discord: Emily) 05/07/2023 22:02

Don't know that either
I knew JS, Java, C++ at that point
python has been added since

=== @ Twilight Knight 05/07/2023 22:03

It's good to take on a new challenge üí™ 
What I was more trying to say is I would've chosen something I was familiar with

=== @EmilyV99 (discord: Emily) 05/07/2023 22:03

yeah, fair

=== @ Twilight Knight 05/07/2023 22:03

PHP I can dream by now

=== @EmilyV99 (discord: Emily) 05/07/2023 22:03

I will also note, my autistic ass brain does visualizing of data sets like this really well, so I didn't struggle in the slightest with the sheets design

=== @ Twilight Knight 05/07/2023 22:03

Sadly

=== @EmilyV99 (discord: Emily) 05/07/2023 22:03

especially since I'm the one who designed it lol

=== @ Twilight Knight 05/07/2023 22:04

Haha I also often use sheets, f.e. for my finances

=== @EmilyV99 (discord: Emily) 05/07/2023 22:04

it's basically just a 3d array, with the tabs, then the every-pair-of-two-columns, then the rows

=== @ Twilight Knight 05/07/2023 22:04

I like to have a good overview

=== @EmilyV99 (discord: Emily) 05/07/2023 22:04

which, in python, is just a 3-layer folder structure
same exact data, in the same 3d structure, just visualized differently

=== @ Twilight Knight 05/07/2023 22:05

Hmm yea, like a recursive array you mean?
Arrays in arrays in arrays üòµ

=== @EmilyV99 (discord: Emily) 05/07/2023 22:05

One of the first projects I worked on required working with a 4D array, which, doesn't work in pure spatial dimensions lol
but, code-wise, it works the exact same going from 2d to 3d as it does from 3d to 4d or 4d to 5d. It may be harder to visualize spatially, but code-wise it scales very standardly
you would go from 2 nested loops to 3, then to 4, etc for example to iterate each element
or, in the python example here, you would go from a 3-deep folder structure to 4-deep or 5-deep
(The sheets example does NOT scale much further well, getting the 3rd dimension out of "pairs of columns" is already a bit stretchy)

=== @ Twilight Knight 05/07/2023 22:08

Yea it's the same thing. The real challenge comes when the recursive-ness is infinite. When you allow users to make trees themselves. I've worked on a project with that requirement it was tough

=== @EmilyV99 (discord: Emily) 05/07/2023 22:08

yeah, that's painful. Working with a rigid structure is much easier than a flex structure.
Which, I mean
(replying to @ Twilight Knight "Yea it's the same thing. The‚Ä¶"): The ZScript parser is exactly this
so
I ***ABSOLUTELY*** understand lol

=== @ Twilight Knight 05/07/2023 22:09

I can't recall exactly why but it was some kind of brochure/PDF generator thing with selecting products to display in groups and stuff
haha

=== @EmilyV99 (discord: Emily) 05/07/2023 22:09

I mean literally
2 + 2 + 2 + 2 + 2 + 2
every `+` sign there is an AST node
so you have `2 + (2 + (2 + (2 + (2 + 2))))`

=== @ Twilight Knight 05/07/2023 22:10

Damn really

=== @EmilyV99 (discord: Emily) 05/07/2023 22:10

5 nodes deep in that tree just for that addition
because addition is a binary operation
so each `+` sign, that's a node

=== @ Twilight Knight 05/07/2023 22:10

Is it not able to follow basic math rules on its own?
Ah ok

=== @EmilyV99 (discord: Emily) 05/07/2023 22:11

(replying to @ Twilight Knight "Is it not able to follow basi‚Ä¶"): that happens before it gets to ZASM, but the AST generation is the very first step
well, second step?
First, the `flex` takes the raw text and tokenizes it
then the `bison` directly uses those tokens to generate the AST tree
after that, the `RegistrationVisitor` recurses through the tree, registering things (like type defintions, script/function/global variables/global constants)
if, after it has visited every node, any single node failed to register (i.e. had an error), it will recurse the entire tree again (skipping nodes that were entirely finished previously without entering their recursion)
which is what allows things like this to compile:```cpp
const int A = B;
const int B = 5;
const int C = B;```
Whether you go top-to-bottom or bottom-to-top, you always hit something that tries to read from `B`, before you find that `B` exists
so, either `A` or `C` would fail to register on the first pass

=== @ Twilight Knight 05/07/2023 22:13

Ahh

=== @EmilyV99 (discord: Emily) 05/07/2023 22:13

but then `B` would be registered
and on the next pass, the failed node would find that `B` now exists, and succeed.

=== @ Twilight Knight 05/07/2023 22:14

I always wondered how that worked

=== @EmilyV99 (discord: Emily) 05/07/2023 22:14

That's also entirely my design
one of my biggest parser changes

=== @ Twilight Knight 05/07/2023 22:14

Usually compilers throw a nice fatal error on that kind of issue

=== @EmilyV99 (discord: Emily) 05/07/2023 22:14

yeah, I wanted it handled.
It especially mattered with namespaces and such the way parsing works
our parsing shit is kinda janky
having the ability to do multiple attempt passes is good
Oh, and also
if something were to fail, it does another pass
if it does a pass and *nothing on that pass succeeds*, it stops recursing immediately and throws whatever the error is.
Well, actually, no, it doesn't- because it doesn't know that info.

=== @ Twilight Knight 05/07/2023 22:16

Ah so to not do it unnecessarily

=== @EmilyV99 (discord: Emily) 05/07/2023 22:16

it just goes to the next pass

=== @ Twilight Knight 05/07/2023 22:16

Oh

=== @EmilyV99 (discord: Emily) 05/07/2023 22:16

which then throws the error
but, the point being it stops doing loops when it knows further loops won't fix anything
because at least 1 thing needs to succeed for the outcome of a new loop to be different

=== @ Twilight Knight 05/07/2023 22:16

Yea exactly I thought that was what you meant

=== @EmilyV99 (discord: Emily) 05/07/2023 22:16

After registration, whether it succeeded at everything, or failed and could not fix it, it goes to the `SemanticAnalyzer`

=== @ Twilight Knight 05/07/2023 22:17

Very solid approach I figure? I have no experience with such things, always thought the compiler and the whole ZScript language things must've been a difficult thing to engineer

=== @EmilyV99 (discord: Emily) 05/07/2023 22:17

the `RegistrationVisitor` was basically an edited copy of the `SemanticAnalyzer` in how it handles a lot of things
except the registration visitor never goes inside functions, and it fails "softly" allowing try-again
`SemanticAnalyzer` fails fatally, which throws the actual error
which is why the registration visitor just goes to the semantic analyzer if it knows it failed, as that already has all the fatal error handling set up
no need to duplicate the code
Any node that was successfully registered may be treated differently in the semantic analyzer phase, as they are marked with a `bool registered`

=== @ Twilight Knight 05/07/2023 22:19

Then why is it necessary to have both functions?

=== @EmilyV99 (discord: Emily) 05/07/2023 22:19

SemanticAnalyzer is the only one that handles inside of functions, and handles the fatal errors

=== @ Twilight Knight 05/07/2023 22:19

Wouldn't the semanticanalyzer be able to do that registration part as well?

=== @EmilyV99 (discord: Emily) 05/07/2023 22:20

Not really
that's just not how it works

=== @ Twilight Knight 05/07/2023 22:20

Or no, guess not otherwise it would not be able to know the relations between code etc righjt?
Like "that variable exists" etc

=== @EmilyV99 (discord: Emily) 05/07/2023 22:20

exactly
the registration has the unique design allowing it to try multiple times to get all of those things known

=== @ Twilight Knight 05/07/2023 22:20

I see

=== @EmilyV99 (discord: Emily) 05/07/2023 22:21

the act of having a fatal error thrown prevents you from looping again
The registration visitor can throw SOME fatal errors, for the record- for things that it knows can't be fixed

=== @ Twilight Knight 05/07/2023 22:21

myvar int; or somewhat

=== @EmilyV99 (discord: Emily) 05/07/2023 22:21

i.e. if you were to declare `void x = 5;`, the `You can't declare a variable of type void` error can't be fixed by any further code

=== @ Twilight Knight 05/07/2023 22:21

Ah yea that kindastuff

=== @EmilyV99 (discord: Emily) 05/07/2023 22:22

However, `sdgdasf x = 5;` is different- because it might find that later code contains `typedef const int sdgdasf;`, which would make that a valid statement
so, that can't fatally fail in the registration phase

=== @ Twilight Knight 05/07/2023 22:22

Hmm so it would resolve that in another loop

=== @EmilyV99 (discord: Emily) 05/07/2023 22:23

but, the semantic analyzer, if it finds that `sdgdasf` is not a valid type, it knows that it won't ever be, and can fatally error on that

=== @ Twilight Knight 05/07/2023 22:23

But wouldn't it generally be considered best practice to put your code in the order of usage? It is nice that you made it foolproof in the registration thing though

=== @EmilyV99 (discord: Emily) 05/07/2023 22:24

The way `import`s work, that would require you to put your imports in certain orders, and make some things REALLY janky for the end user.
It's just cleaner for everyone this way

=== @ Twilight Knight 05/07/2023 22:24

Yea ease of access kinda thing
I like it, most languages wouldn't even support that

=== @EmilyV99 (discord: Emily) 05/07/2023 22:24

especially with a target audience of non-programmers
it really helps
Anyway, if semantic analyzing passes, that means the script has compiled successfully

=== @ Twilight Knight 05/07/2023 22:25

yea it takes making that mistake one time to learn about it. Best not to have it happen at all

=== @EmilyV99 (discord: Emily) 05/07/2023 22:25

and it goes on to the generate opcodes phase
which uses the `BuildOpcodes` recursive visitor
This is where things like `int x = 2 + 2 + 2 + 2 + 2 + 2 + 2;` get trimmed down
because, when it gets a `caseExprAdd`
it checks it's `getCompileTimeValue()` to see if it is constant
which, itself, will recursively check that of each operand of the expression
In this case, since they are all `ASTNumberLiterals`, they are all constant, and return their constant values, which are then recursively summed, returning the whole sum as the constant value of the entire expression.

=== @ Twilight Knight 05/07/2023 22:27

becoming int x = 14;

=== @EmilyV99 (discord: Emily) 05/07/2023 22:27

thus, `int x = 2 + 2 + 2 + 2 + 2 + 2 + 2;` and `int x = 14;` produce the same ZASM

=== @ Twilight Knight 05/07/2023 22:27

Sweet

=== @EmilyV99 (discord: Emily) 05/07/2023 22:27

despite having vastly different AST trees

=== @ Twilight Knight 05/07/2023 22:27

I really wouldn't have known there is so many optimisations and all even

=== @EmilyV99 (discord: Emily) 05/07/2023 22:27

Also, if any of those was a `const int`, that would fetch the value of that constant and do the same with it
And, I've done some further fancy optimizations

=== @ Twilight Knight 05/07/2023 22:28

And I've been trying to write efficient code for no reason üòõ

=== @EmilyV99 (discord: Emily) 05/07/2023 22:28

for instance, in the case of `0 * x` or `x * 0`, it knows that the value is, in fact, the constant value `0`

=== @ Twilight Knight 05/07/2023 22:28

That is good also

=== @EmilyV99 (discord: Emily) 05/07/2023 22:28

and in the case of `1 * x` and `x * 1`, it knows that the value is, in fact, just `x`, which while is not constant, takes less ZASM to read than needing to do a multiplication.

=== @ Twilight Knight 05/07/2023 22:29

Those kind of optimisations are really good, however insignificant they may seem at first. Makes ZC all the better

=== @EmilyV99 (discord: Emily) 05/07/2023 22:29

`0 + x`, `x + 0`, `x - 0`, and `0 / x` all also optimize similarly

![image](https://cdn.discordapp.com/attachments/1104735608309563473/1104897979476869241/image.png?ex=65e4f9ee&is=65d284ee&hm=443b0498b290d4e953d3745d82504fac87128a251a82256016af5d1c774e8e54&)

=== @ Twilight Knight 05/07/2023 22:30

But now so far it seems these parts are not the spaghetti code right?

=== @EmilyV99 (discord: Emily) 05/07/2023 22:30

`x / 0` throws a warning, but not a fatal error

=== @ Twilight Knight 05/07/2023 22:30

Also nice for non programmers

=== @EmilyV99 (discord: Emily) 05/07/2023 22:30

Oh, no, this is the parser I've spent the last 4-5 years beautifying
it's gotten a LOT better since I started
and, grayswandir did a lot to make it better than the 2.50.2 one before I started
But, this just generates the ZASM as a `vector<Opcode>` output
which is NOT usable by ZC
This is the end of the actual parser's job, though- `zscript.exe` ends here, returning this vector to `zquest.exe`
At that point, `Compile Success!`, and you go to the assign slots dialog

=== @ Twilight Knight 05/07/2023 22:32

Aha, btw Deedee made that external zscript.exe right? I recall reading such

=== @EmilyV99 (discord: Emily) 05/07/2023 22:33

after assigning slots, it loops through each and every single slot, and for every slot that has a valid script in it, it writes that `vector<Opcode>` out to a file using the `Opcode->WriteLine()` method
(replying to @ Twilight Knight "Aha, btw Deedee made that ext‚Ä¶"): actually, connor originally made the `.exe`, but didn't attach it to zquest.
Then I attached it to zquest, but it was slow and laggy.
Then Deedee came in and fixed the lag and fancied it.
so, we all played our parts in that

=== @ Twilight Knight 05/07/2023 22:33

Ah alright, group effort üí™

=== @EmilyV99 (discord: Emily) 05/07/2023 22:34

Connor had submitted it as a pull request, when Zoria was still lead dev- Zoria was too proud to accept any help
around that time is when we booted his ass out

=== @ Twilight Knight 05/07/2023 22:34

I dunno, sometimes periods go by I don't check forums/discord much and then suddenly there is a lot of new stuff haha

=== @EmilyV99 (discord: Emily) 05/07/2023 22:34

accepted connor's PR, and I modified it to work with ZQ
and that's when connor started working more with us

=== @ Twilight Knight 05/07/2023 22:34

Nice
Yea that Zoria... not the time and place to discuss, but heh

=== @EmilyV99 (discord: Emily) 05/07/2023 22:35

(replying to @EmilyV99 (discord: Emily) "after assigning slots, it loo‚Ä¶"): So, the point here is, it's after it comes back to ZQ that it does the Assign Slots, which then writes out to file and then imports the file as a zasm file using that old code
which, it has to parse through the files as it goes through
....it does have two phases already, IIRC, so I may only have to rewrite the first phase of it
the old first phase would still be used for importing ZASM files, but the new one would be used for dumping a `vector<Opcode>` directly into the correct `ffscript` format that ZC reads without using external files
and that's basically the spaghetti rewrite part
but, it's both the first phase of that, as well as the part that writes out the file on the assign dialog side of things

=== @ Twilight Knight 05/07/2023 22:38

So you want to get rid of all that needless converting and writing to files and then parsing it back etc?

=== @EmilyV99 (discord: Emily) 05/07/2023 22:38

yep

=== @ Twilight Knight 05/07/2023 22:38

That would surely make it all a lot faster

=== @EmilyV99 (discord: Emily) 05/07/2023 22:38

I feel like it has to
we'll see how good the change is

=== @ Twilight Knight 05/07/2023 22:39

Sounds like an interesting project though
And sure you can accomplish üí™

=== @EmilyV99 (discord: Emily) 05/07/2023 22:39

Every time I rewrite sections of old code it's always an interesting endeavor
I mean, I literally just rewrote all of Link's movement
that was fun

=== @ Twilight Knight 05/07/2023 22:39

Oh god

=== @EmilyV99 (discord: Emily) 05/07/2023 22:40

....and, you know, I actually do mean that non-sarcastically
it mostly kinda just worked first try
and most of it was copy-paste from the enemy movement stuff I had already added
(`npc->MoveXY()`)

=== @ Twilight Knight 05/07/2023 22:40

Hmm nice
I imagine especially the collision detection is difficult

=== @EmilyV99 (discord: Emily) 05/07/2023 22:40

but, adapted for Link's hitbox
and each of the sub-functions it calls also had to be duplicated
with the correct checks for Link instead of enemies
but it was mostly just a conversion thing there

=== @ Twilight Knight 05/07/2023 22:41

üò± inefficient, why is there no parent class for NPCs and Hero?

=== @EmilyV99 (discord: Emily) 05/07/2023 22:41

There is, but it does not contain movement, because their movements have a lot of very different collision checks

=== @ Twilight Knight 05/07/2023 22:41

Ah okay

=== @EmilyV99 (discord: Emily) 05/07/2023 22:41

for instance, the enemy being flying, or dealing with No Enemies flags

=== @ Twilight Knight 05/07/2023 22:41

Yeah many different flags and all

=== @EmilyV99 (discord: Emily) 05/07/2023 22:42

or various hardcoded jank involving NES dungeons
there's a lot of that

=== @ Twilight Knight 05/07/2023 22:42

Bleh, I wish it could just be removed from ZC haha
I love the original NES Zelda but it's slow and janky

=== @EmilyV99 (discord: Emily) 05/07/2023 22:42

Oh, the big thing was, I had to re-create the "Corner Alignment Shove" for Link's movement
for like, when you run into the corner of a combo, but by less than 4 pixels, it shoves you sideways so you brush past it
and that just worked perfectly

=== @ Twilight Knight 05/07/2023 22:43

Aww yea nerdgasm  haha
That is just the perfect feeling though when the code works immediately, better than orgasm üòÇ

=== @EmilyV99 (discord: Emily) 05/07/2023 22:44

The thing is, his original movement was REALLY FUCKING JANKY HARDCODED BULLSHIT
and then I made `New Hero Movement` to clean it up ***SOMEWHAT***.
The main goal was to allow `Hero->Step` to work properly
also that was done in Japan, on my laptop, a week before finals, right before flying home racing against COVID.
soooooo
was not a perfect total rewrite of awesomeness
and I hadn't done the enemy movement rewrite yet to have a basis for copying
I made it better, but I left so much spaghetti unfixed

=== @ Twilight Knight 05/07/2023 22:45

I like that change already though, finally being able to modify speed via scripts

=== @EmilyV99 (discord: Emily) 05/07/2023 22:45

....`Newer Player Movement` now just cleans up all that leftover spaghetti
(the old one was renamed to `New Player Movement` at some point, trying to keep `Player` as the consistent chosen term)

=== @ Twilight Knight 05/07/2023 22:46

You could expect nargad's trail to use it

=== @EmilyV99 (discord: Emily) 05/07/2023 22:46

Now with `Newer Player Movement`, you can have ANY COMBO modify your speed while you are walking over it

=== @ Twilight Knight 05/07/2023 22:46

ü§©

=== @EmilyV99 (discord: Emily) 05/07/2023 22:46


![image](https://cdn.discordapp.com/attachments/1104735608309563473/1104902209038196796/image.png?ex=65e4fdde&is=65d288de&hm=f4bdc5f4bafe58e2b1e5cd7e0e4ca4142ed6b43730b74432cfc828da70c0e2ec&)

=== @ Twilight Knight 05/07/2023 22:47

How about moving with built in coll detection?
Right now I achieve it with InputDown = true f.e. üòÇ

=== @EmilyV99 (discord: Emily) 05/07/2023 22:47

That is planned, I just need to add zscript access, but I burnt myself out a bit much
so, when dev energy strikes again

=== @ Twilight Knight 05/07/2023 22:47

NP this is already awesome

=== @EmilyV99 (discord: Emily) 05/07/2023 22:47

Also, it works on every layer

=== @ Twilight Knight 05/07/2023 22:47

Awesomeee üëç

=== @EmilyV99 (discord: Emily) 05/07/2023 22:47

it applies layer 6 first, then layer 5, then 4, going down
if it hits a `Bridge` combo, it stops and doesn't check lower layers

=== @ Twilight Knight 05/07/2023 22:48

Hmm yea that CT is interesting also
And so the speed is cumulative btw?

=== @EmilyV99 (discord: Emily) 05/07/2023 22:48

It does `((Distance to move / divisor) * multiplier) + adder`

=== @ Twilight Knight 05/07/2023 22:48

if on multiple layers

=== @EmilyV99 (discord: Emily) 05/07/2023 22:48

for each, cumulatively, yes

=== @ Twilight Knight 05/07/2023 22:48

Nice üòÑ
Many more potential shenanigans unlocked

=== @EmilyV99 (discord: Emily) 05/07/2023 22:49

Only one combo POSITION can affect link at a time- identical to how the Slow Combo type used to work, it uses `x+7,y+8`
but, all layers (not obstructed by `Bridge` combos) will apply, in order from highest to lowest.

=== @ Twilight Knight 05/07/2023 22:50

This is good

=== @EmilyV99 (discord: Emily) 05/07/2023 22:50


![image](https://cdn.discordapp.com/attachments/1104735608309563473/1104903141956264036/image.png?ex=65e4febd&is=65d289bd&hm=b569bc667641967797763a3ceb63179cadd60e3a0addf39e4e70ed898de5c880&)
`/ 0` acts the same as `/ 1`, having no effect
`* 0` will freeze you in place

=== @ Twilight Knight 05/07/2023 22:50

And I always use x+8,y+8 myself to determine combo at feet, wonder if I should change it

=== @EmilyV99 (discord: Emily) 05/07/2023 22:51

and the additive, can be negative as well
(the mult/div are 0-255)
the additive, I will note, is not in *step speed*, but instead in *pixels*. It does have decimal places.
(the `?` buttons do explain all of this)

=== @ Twilight Knight 05/07/2023 22:52

Geez that could is near magic to me. Never seen mapscr* or zfix* stuff like that for example

=== @EmilyV99 (discord: Emily) 05/07/2023 22:52

(and, the very top `?` button even *references the QR for you*)
![image](https://cdn.discordapp.com/attachments/1104735608309563473/1104903611407933490/image.png?ex=65e4ff2d&is=65d28a2d&hm=92e7666eb34807a52a142d292da097fd361e27c2368ad8efe8b373ab48421188&)
(because yeah, I added that)
(replying to @ Twilight Knight "Geez that could is near magic‚Ä¶"): `mapscr*` is basically like zscript `Screen->` or `mapdata->`

=== @ Twilight Knight 05/07/2023 22:53

why the asteriks?

=== @EmilyV99 (discord: Emily) 05/07/2023 22:53

`zfix` is actually surprisingly *exactly the same* as ZScript `int`- it's a fixed-place number with 4 decimal places
the asterisks indicate that those are a pointer
to another location in memory
Similar to using an array in zscript
when you pass an array into a function
and you modify the contents of that array
they are modified everywhere that accesses that array, not just in the function

=== @ Twilight Knight 05/07/2023 22:54

(replying to @EmilyV99 (discord: Emily) "`zfix` is actually surprising‚Ä¶"): doubledouble üòé

=== @EmilyV99 (discord: Emily) 05/07/2023 22:54

pointers can do that for single variables, rather than arrays
or, in this case, I have a vector of pointers
(a vector being an automatically-resizing array)
(...which I used here, for the easy initializing of it using `{}`, just like ZScript allows with arrays)
so, actually, this is working surprisingly similar to zscript stuff lol

=== @ Twilight Knight 05/07/2023 22:55

Ah I see, like a singleton

=== @EmilyV99 (discord: Emily) 05/07/2023 22:55


![image](https://cdn.discordapp.com/attachments/1104735608309563473/1104904390143385761/image.png?ex=65e4ffe6&is=65d28ae6&hm=7a6c2712cd47dab323567b7662ecf2097f9e3dfb761a0b8caf3f4c56f6a93bb5&)

=== @ Twilight Knight 05/07/2023 22:55

A static globally accessible class

=== @EmilyV99 (discord: Emily) 05/07/2023 22:55

So, here, I declare 6 local variables of type `zfix`
then I create a `vector` of `zfix` pointers, and add pointers to 5 of the local variables to that vector
and then I call the `mod_steps` function with that vector- which is where the code I posted earlier was from
it loops through each pointer in the vector, applying the speed modification for all the combos to each of those 5 movement values
(This is because of Sideview Swimming that Deedee added, which has different speeds for different directions)
(so, I need to apply the change to each speed)

=== @ Twilight Knight 05/07/2023 22:57

Interesting, especially the code structure with the zfix class.
But I guess that is just necessary to standardise the decimal numbers

=== @EmilyV99 (discord: Emily) 05/07/2023 22:58

Floating point rounding error is a problem with float classes
and, funnily enough, Allegro's `fix` class?
It also has rounding error, because it uses a similar storage method to floating point
because YAY.
Which, you know how in 2.50.2 you couldn't access subpixel coordinates of enemies and stuff?

=== @ Twilight Knight 05/07/2023 22:59

Yea

=== @EmilyV99 (discord: Emily) 05/07/2023 22:59

Well, adding access to that didn't work too well, because *rounding error*.

=== @ Twilight Knight 05/07/2023 22:59

Ah haha
Sounds pretty fucked

=== @EmilyV99 (discord: Emily) 05/07/2023 23:00

So I had to write the entire `zfix` class from scratch, mostly mimicing allegro's `fix` class for all of the functions and type conversions it can handle, with a couple nice utility functions, but based on the zscript `int * 10000` system of storing perfect 4-place precision

=== @ Twilight Knight 05/07/2023 23:00

I'm really gonna have to go to bed btw, I need to get up in 6 hours and still need to roll a gnite smoke

=== @EmilyV99 (discord: Emily) 05/07/2023 23:01

It automatically handles most common type conversions, so this code is perfectly fine:
```cpp
zfix x; //defaults to 0
x += 0.5; //this is a float 0.5, it adds just fine
x * 2; //an int 2, also just fine.```
every single operator needed a function defined for it
for each different type

=== @ Twilight Knight 05/07/2023 23:01

Ah and then you did find & replace on the codebase, fix to zfix I imagine üòÇ

=== @EmilyV99 (discord: Emily) 05/07/2023 23:01

pretty much
was a TON of work
but it paid off in the end

=== @ Twilight Knight 05/07/2023 23:01

Ah that is nice, but shit that such things are in allegro

=== @EmilyV99 (discord: Emily) 05/07/2023 23:01

(replying to @ Twilight Knight "I'm really gonna have to go t‚Ä¶"): g'nite, nice chat ‚ù§Ô∏è

=== @ Twilight Knight 05/07/2023 23:01

I thought it was commonly used
Yes nice chatting and interesting topics! I learned a lot üß† 
Though peeps must wonder this is a really complicated feature request haha
Good day/night!

=== @EmilyV99 (discord: Emily) 05/07/2023 23:02

haha lol yeah, let me just pin some of the FR stuff
(meta, MessageType.pins_add) 
(meta, MessageType.pins_add) 

=== @arceusplayer11 (discord: Deedee) 05/08/2023 10:22

(replying to @EmilyV99 (discord: Emily) "and basically, the way it wor‚Ä¶"): not to be confused with the writing out to a file when compiling, which is used because the compiler and zquest are now two separate programs and writing to a file and reading it is faster than opening a direct pipeline between the two programs
