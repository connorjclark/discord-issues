## ‚ùåLayered Lock Blocks Don't Work by Default (#1104)
@ Orithan opened this issue on 10/12/2021
Status: wont-fix
Tags: 
Source: #old-bug-reports https://discord.com/channels/876899628556091432/897407891336728637


=== @ Orithan 10/12/2021 08:58

Scripted Fire still harms the player even if the following are set:
Quest Rules, Items: ``Scripted Fire Weapons Don't Hurt Link``
Player Defenses: ``Fire or Candle Fire Player Defense = ignore``

ZC Alpha 97, Windows 10

=== @EmilyV99 (discord: Emily) 10/12/2021 14:10

What is the fire's `->Weapon` and `->ParentItem`? @ Orithan

=== @ Orithan 10/12/2021 14:26

``LW_FIRE``, A ``Lantern`` item

=== @EmilyV99 (discord: Emily) 10/13/2021 13:28

so, there's your issue
shouldn't set that to a lantern item
`Scripted ....` qrs affect items with `ParentItem < 0`
if `ParentItem > -1`, it reads flags from the item editor data
....and those flags on a lantern, are not the flags it expects from a candle

![image](https://cdn.discordapp.com/attachments/897407891336728637/897838706172526652/unknown.png?ex=65e86ff4&is=65d5faf4&hm=afd070a73754439067bea1e7c508107c6d67f1f78902a237667d4ce2df944880&)

![image](https://cdn.discordapp.com/attachments/897407891336728637/897838777853157386/unknown.png?ex=65e87005&is=65d5fb05&hm=66613dbe5aee1deef70fdf0609a3ba4217d0e8c00c35377f5dc13f8ff503f6e8&)
`Flags[2]`, `Fire Doesn't Hurt Player`
obviously the lantern is not intended to be the parent to fire weapons, so it doesn't have such a name for the flag
and the lantern could have new flags added in the future that could conflict with that
so, no bug here, just user error with wrongly modifying `ParentItem`

=== @EmilyV99 (discord: Emily) 10/13/2021 13:33

(meta) thread name was changed: ‚ùåüîíScripted Fire still hurts Player despite being set otherwise.

=== @ Orithan 10/13/2021 13:56

That's pretty annoying tbh because this is 1) poorly documented and 2) ``ParentItem`` may be used by scripters for functionality

=== @ Orithan 10/13/2021 13:58

I would like for that to be decoupled with ``ParentItem`` in the future or at the very least have a setting that sets "Do not hurt player"

=== @EmilyV99 (discord: Emily) 10/13/2021 14:01

The purpose of ParentItem is to make an item behave as though it were generated by the given item ID

=== @ Orithan 10/13/2021 14:02

And that's the only easy way to deal with level triggers if I ever need them

=== @EmilyV99 (discord: Emily) 10/13/2021 14:09

so
`1) poorly documented` adding documentation
`2) ParentItem may be used by scripters for functionality` Scripter error is scripter error

=== @EmilyV99 (discord: Emily) 10/13/2021 14:11

`I would like for that to be decoupled with ParentItem in the future or at the very least have a setting that sets "Do not hurt player" `
^This requires literally rewriting most of how weapons work
and would take months
```
int Parent;
npc Parent;
 * The ID of the item, or pointer of the npc (respectively for lweapon, and for eweapon) that created this weapon.
 * Weapons created by script have a default Parent of -1 (lweapon) and <npc>-0.0001 (eweapon). 
 * For lweapons, this value determines what item editor index to read item flags from.
 *     Setting it to an item of a class that does not normally generate the given weapon
 *     type may have unexpected effects.```

=== @EmilyV99 (discord: Emily) 10/13/2021 14:14

(replying to @ Orithan "And that's the only easy way‚Ä¶"): ?
what does any of this have to do with level triggers?

=== @ Orithan 10/13/2021 14:15

Level triggers use ParentItem as a reference?

=== @EmilyV99 (discord: Emily) 10/13/2021 14:15

oh, duh
...do they?
Or do they read `lweapon->Level`?

=== @ Orithan 10/13/2021 14:15

AFIAK

=== @EmilyV99 (discord: Emily) 10/13/2021 14:18

Book fire seems to burn blue, red, wand fire triggers no matter what
or wait, no, that's magic with the insta-burn book flag
the generic `wFire` code
runs
```
findentrance(x,y,mfBCANDLE,true);

if(type>1) //red candle 
{
    findentrance(x,y,mfRCANDLE,true);
}

if(linked_parent == itype_dinsfire)
{
    findentrance(x,y,mfDINSFIRE,true);
}
```
`type` here is `lweapon->Level`
(`linked_parent` is hardcoded garbage)

=== @EmilyV99 (discord: Emily) 10/13/2021 14:21

. . . boomerangs seem to use the item editor though
what the fuck

=== @EmilyV99 (discord: Emily) 10/13/2021 14:22

uhg
So, if you want better level trigger stuff, that'd be a feature request to file
`ParentItem` is not changing though, it's far too much work to change

=== @ Orithan 10/13/2021 22:52

Mhm
